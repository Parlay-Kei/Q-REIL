# PLATOPS-QREIL-CI-VERCEL-AUTH-AND-ENV-0007: Vercel auth check and env assert in CI
# Runs: vercel-auth-check.js, vercel-env-assert.js from StrataNoble-OPS. Requires GitHub secret: VERCEL_TOKEN (names only in receipts).

name: Q REIL Vercel auth and env assert

on:
  workflow_dispatch:

jobs:
  vercel-auth-and-env:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout StrataNoble-OPS
        uses: actions/checkout@v4
        with:
          repository: Parlay-Kei/StrataNoble-OPS
          path: ops
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'
          cache-dependency-path: ops/package-lock.json

      - name: Install OPS deps
        run: npm ci
        working-directory: ops

      - name: Vercel auth check
        env:
          VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
        run: node scripts/ops/vercel-auth-check.js
        working-directory: ops

      - name: Vercel env assert (keys only)
        env:
          VERCEL_TOKEN: ${{ secrets.VERCEL_TOKEN }}
        run: node scripts/ops/vercel-env-assert.js
        working-directory: ops
